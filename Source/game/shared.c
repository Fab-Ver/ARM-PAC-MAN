#include "config.h"
#include <stdbool.h>
 
typedef enum {PLAYING, START, PAUSE, GAME_OVER, VICTORY} game_state;
volatile game_state current_game_state = PAUSE; 

typedef enum {UP, DOWN, LEFT, RIGHT, NONE} joystick_position;
volatile joystick_position curr_joystick_position = NONE; 

volatile int16_t score = 0;
volatile int16_t prev_score = 1;
volatile uint8_t countdown = 60;
volatile uint8_t lives = 1; 
volatile uint8_t prev_lives = 0;
volatile bool power_pill_active = false;

volatile uint8_t map[ROWS][COLUMNS] = {
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
    {1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1},
    {1, 2, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 2, 1},
    {1, 2, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 2, 1},
    {1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1},
    {1, 2, 1, 1, 1, 2, 1, 2, 1, 1, 1, 1, 1, 1, 1, 2, 1, 2, 1, 1, 1, 2, 1},
    {1, 2, 2, 2, 2, 2, 1, 2, 1, 1, 1, 1, 1, 1, 1, 2, 1, 2, 2, 2, 2, 2, 1},
    {1, 2, 1, 1, 1, 2, 1, 2, 2, 2, 2, 1, 2, 2, 2, 2, 1, 2, 1, 1, 1, 2, 1},
    {1, 2, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 2, 1},
    {1, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 1},
    {1, 1, 1, 1, 1, 2, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 2, 1, 1, 1, 1, 1},
    {0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 1, 1, 1, 1, 2, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 2, 1, 1, 1, 1, 1},
    {1, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 1},
    {1, 2, 1, 1, 1, 2, 1, 2, 1, 1, 1, 1, 1, 1, 1, 2, 1, 2, 1, 1, 1, 2, 1},
    {1, 2, 1, 1, 1, 2, 1, 2, 1, 1, 1, 1, 1, 1, 1, 2, 1, 2, 1, 1, 1, 2, 1},
    {1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1},
    {1, 2, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 2, 1},
    {1, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 1},
    {1, 1, 1, 2, 1, 2, 1, 2, 1, 1, 1, 1, 1, 1, 1, 2, 1, 2, 1, 2, 1, 1, 1},
    {1, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 1, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 1},
    {1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1},
    {1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1},
    {1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}
};

uint8_t square[SQUARE_SIZE][SQUARE_SIZE] = { 
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1}, 
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1}
};

 uint8_t pill_circle[SQUARE_SIZE][SQUARE_SIZE] = {
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 0},  // Row 1
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 0},  // Row 2
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 0},  // Row 3
        {0, 0, 0, 0, 1, 1, 0, 0, 0, 0},  // Row 4
        {0, 0, 0, 1, 1, 1, 1, 0, 0, 0},  // Row 5
        {0, 0, 0, 1, 1, 1, 1, 0, 0, 0},  // Row 6
        {0, 0, 0, 0, 1, 1, 0, 0, 0, 0},  // Row 7
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 0},  // Row 8
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 0},  // Row 9
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 0}   // Row 10
};
 
uint8_t pacman_circle[SQUARE_SIZE][SQUARE_SIZE] = {
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 0},   // Row 1
        {0, 0, 0, 0, 1, 1, 0, 0, 0, 0},   // Row 2
        {0, 0, 1, 1, 1, 1, 1, 1, 0, 0},   // Row 3
        {0, 0, 1, 1, 1, 1, 1, 1, 0, 0},   // Row 4
        {0, 1, 1, 1, 1, 1, 1, 1, 1, 0},   // Row 5
        {0, 1, 1, 1, 1, 1, 1, 1, 1, 0},   // Row 6
        {0, 0, 1, 1, 1, 1, 1, 1, 0, 0},   // Row 7
        {0, 0, 1, 1, 1, 1, 1, 1, 0, 0},   // Row 8
        {0, 0, 0, 0, 1, 1, 0, 0, 0, 0},   // Row 9
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 0}    // Row 10
 };
